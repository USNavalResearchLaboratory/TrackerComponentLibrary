function [xi,w]=eighthOrderTetrahedronPoints(algorithm)
%%EIGHTHORDERTETRAHEDRONPOINTS Obtain eighth-order cubature points for
%   integration over a tetrahedron in 3D. The points and weights are for
%   the tetrahedron with vertices (1,0,0), (0,1,0), (0,0,1), and (0,0,0),
%   but can be transformed to any tetrahedron using
%   transformSimplexTetrahedronPts.
%
%INPUTS: algorithm An optional parameter selecting the algorithm for the
%                  specific point set. Possible values are:
%                  0 (The default if omitted or an empty matrix is passed)
%                    Use the algorithm of [1] (46 points).
%                  1 Use the 8th order points found using the algorithm of
%                    [2], given in the supplementary material of [2] (46
%                    points).
%
%OUTPUTS: xi This is a 3XnumCubPoints set of points for the standard
%            tetrahedron.
%          w A 1XnumCubPoints set of cubature weights. This sums to the
%            volume of the standard tetrahedron (1/6).
%
%This function implements the points given in [1] (46 points) and [2] (46
%points).
%
%EXAMPLE:
%Given the vertices of the simplex, we compare an eighth-order moment
%computed using these cubature points to one computed using
%monomialIntSimplex. The results are the same within typical finite
%precision limits.
% [xi,w]=eighthOrderTetrahedronPoints();
% alpha=[3;3;2];
% theMoment=findMomentFromSamp(alpha,xi,w);
% intVal=monomialIntSimplex(alpha);
% RelErr=(theMoment-intVal)/intVal
%
%REFERENCES:
%[1]L. Zhang and T. Cui, "A set of symmetric quadrature rules on triangles
%   and tetrahedra," Journal of Computational Mathematics, vol. 27, no. 1,
%   pp. 89-96, Jan. 2009.
%[2] F. D. Witherden and P. E. Vincent, "On the identification of symmetric
%    quadrature rules for finite element methods," Computer and Mathematics
%    with Applications, vol. 69, no. 10, pp. 1232-1241, May 2015.
%
%October 2022 David F. Crouse, Naval Research Laboratory, Washington D.C.
%(UNCLASSIFIED) DISTRIBUTION STATEMENT A. Approved for public release.

if(nargin<1||isempty(algorithm))
    algorithm=0;
end

switch(algorithm)
    case 0
        w1=0.0063971477799023213214514203351730;
        w2=0.0401904480209661724881611584798178;
        w3=0.0243079755047703211748691087719226;
        w4=0.0548588924136974404669241239903914;
        w5=0.0357196122340991824649509689966176;
        w6=0.0071831906978525394094511052198038;
        w7=0.0163721819453191175409381397561191;
        
        w=[w1*ones(4,1);
           w2*ones(4,1);
           w3*ones(4,1);
           w4*ones(4,1);
           w5*ones(6,1);
           w6*ones(12,1);
           w7*ones(12,1)];
        
        p1=.0396754230703899012650713295393895;
        p2=.3144878006980963137841605626971483;
        p3=.1019866930627033000000000000000000;
        p4=.1842036969491915122759464173489092;
        p5=.0634362877545398924051412387018983;
        p6a=.0216901620677280048026624826249302;
        p6b=.7199319220394659358894349533527348;
        p7a=.2044800806367957142413355748727453;
        p7b=.5805771901288092241753981713906204;
        
        xiBary=zeros(4,46);
        xiBary(:,1:4)=genAllMultisetPermutations([p1;p1;p1;1-3*p1]);
        xiBary(:,5:8)=genAllMultisetPermutations([p2;p2;p2;1-3*p2]);
        xiBary(:,9:12)=genAllMultisetPermutations([p3;p3;p3;1-3*p3]);
        xiBary(:,13:16)=genAllMultisetPermutations([p4;p4;p4;1-3*p4]);
        xiBary(:,17:22)=genAllMultisetPermutations([p5;p5;1/2-p5;1/2-p5]);
        xiBary(:,23:34)=genAllMultisetPermutations([p6a;p6a;p6b;1-2*p6a-p6b]);
        xiBary(:,35:46)=genAllMultisetPermutations([p7a;p7a;p7b;1-2*p7a-p7b]);
        
        %Adjust w for the area of the standard tetrahedron.
        w=w/6;
        
        %Convert the barycentric points into normal cubature points for the
        %standard tetrahedron given the vertices.
        vertices=[1,0,0,0;
                  0,1,0,0;
                  0,0,1,0];
        xi=barycentricCoords2Pt(xiBary,vertices);
    case 1
        M=[-0.78409455007557830303561343854585276851,   -0.78409455007557830303561343854585276851,    0.35228365022673490910684031563755830553,   0.035235534544545108539097313565645827902;
           -0.78409455007557830303561343854585276851,    0.35228365022673490910684031563755830553,   -0.78409455007557830303561343854585276851,   0.035235534544545108539097313565645827902;
            0.35228365022673490910684031563755830553,   -0.78409455007557830303561343854585276851,   -0.78409455007557830303561343854585276851,   0.035235534544545108539097313565645827902;
           -0.78409455007557830303561343854585276851,   -0.78409455007557830303561343854585276851,   -0.78409455007557830303561343854585276851,   0.035235534544545108539097313565645827902;
             -0.629781024434826859446183999496503797,     -0.629781024434826859446183999496503797,     -0.110656926695519421661448001510488609,   0.069375663418318043619861410028472677606;
             -0.629781024434826859446183999496503797,     -0.110656926695519421661448001510488609,     -0.629781024434826859446183999496503797,   0.069375663418318043619861410028472677606;
             -0.110656926695519421661448001510488609,     -0.629781024434826859446183999496503797,     -0.629781024434826859446183999496503797,   0.069375663418318043619861410028472677606;
             -0.629781024434826859446183999496503797,     -0.629781024434826859446183999496503797,     -0.629781024434826859446183999496503797,   0.069375663418318043619861410028472677606;
           -0.91536691263046543675183591431855057189,   -0.91536691263046543675183591431855057189,    0.74610073789139631025550774295565171568,   0.010033674871386933040967405110292766211;
           -0.91536691263046543675183591431855057189,    0.74610073789139631025550774295565171568,   -0.91536691263046543675183591431855057189,   0.010033674871386933040967405110292766211;
            0.74610073789139631025550774295565171568,   -0.91536691263046543675183591431855057189,   -0.91536691263046543675183591431855057189,   0.010033674871386933040967405110292766211;
           -0.91536691263046543675183591431855057189,   -0.91536691263046543675183591431855057189,   -0.91536691263046543675183591431855057189,   0.010033674871386933040967405110292766211;
           -0.37163658175192200927334245312373662702,   -0.37163658175192200927334245312373662702,   -0.88509025474423397217997264062879011895,   0.055685043809246530275971813171748834223;
           -0.37163658175192200927334245312373662702,   -0.88509025474423397217997264062879011895,   -0.37163658175192200927334245312373662702,   0.055685043809246530275971813171748834223;
           -0.88509025474423397217997264062879011895,   -0.37163658175192200927334245312373662702,   -0.37163658175192200927334245312373662702,   0.055685043809246530275971813171748834223;
           -0.37163658175192200927334245312373662702,   -0.37163658175192200927334245312373662702,   -0.37163658175192200927334245312373662702,   0.055685043809246530275971813171748834223;
           -0.12881734283233958954373367640680593526,   -0.87118265716766041045626632359319406474,   -0.87118265716766041045626632359319406474,   0.048374573681745097334959362864457783412;
           -0.87118265716766041045626632359319406474,   -0.12881734283233958954373367640680593526,   -0.87118265716766041045626632359319406474,   0.048374573681745097334959362864457783412;
           -0.12881734283233958954373367640680593526,   -0.12881734283233958954373367640680593526,   -0.87118265716766041045626632359319406474,   0.048374573681745097334959362864457783412;
           -0.12881734283233958954373367640680593526,   -0.87118265716766041045626632359319406474,   -0.12881734283233958954373367640680593526,   0.048374573681745097334959362864457783412;
           -0.87118265716766041045626632359319406474,   -0.12881734283233958954373367640680593526,   -0.12881734283233958954373367640680593526,   0.048374573681745097334959362864457783412;
           -0.87118265716766041045626632359319406474,   -0.87118265716766041045626632359319406474,   -0.12881734283233958954373367640680593526,   0.048374573681745097334959362864457783412;
            0.43492812685261664658005711425116290088,   -0.95713213974573885031100182115353118963,   -0.52066384736113894595805347194410052161,  0.0095425371877925775336250150191510735196;
            0.43492812685261664658005711425116290088,   -0.95713213974573885031100182115353118963,   -0.95713213974573885031100182115353118963,  0.0095425371877925775336250150191510735196;
           -0.95713213974573885031100182115353118963,   -0.95713213974573885031100182115353118963,    0.43492812685261664658005711425116290088,  0.0095425371877925775336250150191510735196;
           -0.52066384736113894595805347194410052161,    0.43492812685261664658005711425116290088,   -0.95713213974573885031100182115353118963,  0.0095425371877925775336250150191510735196;
           -0.95713213974573885031100182115353118963,   -0.52066384736113894595805347194410052161,    0.43492812685261664658005711425116290088,  0.0095425371877925775336250150191510735196;
           -0.95713213974573885031100182115353118963,    0.43492812685261664658005711425116290088,   -0.95713213974573885031100182115353118963,  0.0095425371877925775336250150191510735196;
           -0.52066384736113894595805347194410052161,   -0.95713213974573885031100182115353118963,    0.43492812685261664658005711425116290088,  0.0095425371877925775336250150191510735196;
           -0.95713213974573885031100182115353118963,   -0.52066384736113894595805347194410052161,   -0.95713213974573885031100182115353118963,  0.0095425371877925775336250150191510735196;
           -0.95713213974573885031100182115353118963,   -0.95713213974573885031100182115353118963,   -0.52066384736113894595805347194410052161,  0.0095425371877925775336250150191510735196;
           -0.95713213974573885031100182115353118963,    0.43492812685261664658005711425116290088,   -0.52066384736113894595805347194410052161,  0.0095425371877925775336250150191510735196;
           -0.52066384736113894595805347194410052161,   -0.95713213974573885031100182115353118963,   -0.95713213974573885031100182115353118963,  0.0095425371877925775336250150191510735196;
            0.43492812685261664658005711425116290088,   -0.52066384736113894595805347194410052161,   -0.95713213974573885031100182115353118963,  0.0095425371877925775336250150191510735196;
            0.16759475660428881185333950841466005283,   -0.59172133224794175913941940243963088242,   -0.98415209210840529357450070353539828799,   0.020604648201280446418040434034344443905;
            0.16759475660428881185333950841466005283,   -0.59172133224794175913941940243963088242,   -0.59172133224794175913941940243963088242,   0.020604648201280446418040434034344443905;
           -0.59172133224794175913941940243963088242,   -0.59172133224794175913941940243963088242,    0.16759475660428881185333950841466005283,   0.020604648201280446418040434034344443905;
           -0.98415209210840529357450070353539828799,    0.16759475660428881185333950841466005283,   -0.59172133224794175913941940243963088242,   0.020604648201280446418040434034344443905;
           -0.59172133224794175913941940243963088242,   -0.98415209210840529357450070353539828799,    0.16759475660428881185333950841466005283,   0.020604648201280446418040434034344443905;
           -0.59172133224794175913941940243963088242,    0.16759475660428881185333950841466005283,   -0.59172133224794175913941940243963088242,   0.020604648201280446418040434034344443905;
           -0.98415209210840529357450070353539828799,   -0.59172133224794175913941940243963088242,    0.16759475660428881185333950841466005283,   0.020604648201280446418040434034344443905;
           -0.59172133224794175913941940243963088242,   -0.98415209210840529357450070353539828799,   -0.59172133224794175913941940243963088242,   0.020604648201280446418040434034344443905;
           -0.59172133224794175913941940243963088242,   -0.59172133224794175913941940243963088242,   -0.98415209210840529357450070353539828799,   0.020604648201280446418040434034344443905;
           -0.59172133224794175913941940243963088242,    0.16759475660428881185333950841466005283,   -0.98415209210840529357450070353539828799,   0.020604648201280446418040434034344443905;
           -0.98415209210840529357450070353539828799,   -0.59172133224794175913941940243963088242,   -0.59172133224794175913941940243963088242,   0.020604648201280446418040434034344443905;
            0.16759475660428881185333950841466005283,   -0.98415209210840529357450070353539828799,   -0.59172133224794175913941940243963088242,   0.020604648201280446418040434034344443905];
        w=M(:,4);
        xi=M(:,1:3)';
        %Transform the points to the standard tetrahedron.
        v1=[-1, 1,-1,-1;
            -1,-1,-1, 1;
            -1,-1, 1, -1];
        v2=[1,0,0,0;
            0,1,0,0;
            0,0,1,0];
        [A,d]=affineTransBetweenTetrahedra(v1,v2);
        xi=bsxfun(@plus,A*xi,d);
        w=w/8;
    otherwise
        error('Unknown Algorithm Specified')
end

%LICENSE:
%
%The source code is in the public domain and not licensed or under
%copyright. The information and software may be used freely by the public.
%As required by 17 U.S.C. 403, third parties producing copyrighted works
%consisting predominantly of the material produced by U.S. government
%agencies must provide notice with such work(s) identifying the U.S.
%Government material incorporated and stating that such material is not
%subject to copyright protection.
%
%Derived works shall not identify themselves in a manner that implies an
%endorsement by or an affiliation with the Naval Research Laboratory.
%
%RECIPIENT BEARS ALL RISK RELATING TO QUALITY AND PERFORMANCE OF THE
%SOFTWARE AND ANY RELATED MATERIALS, AND AGREES TO INDEMNIFY THE NAVAL
%RESEARCH LABORATORY FOR ALL THIRD-PARTY CLAIMS RESULTING FROM THE ACTIONS
%OF RECIPIENT IN THE USE OF THE SOFTWARE.
